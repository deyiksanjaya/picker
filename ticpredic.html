<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <!-- META TAG BARU: Mencegah zoom pada perangkat mobile -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Tampilan Papan Realtime</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            /* CSS BARU: Mencegah teks di-highlight/dipilih */
            -webkit-user-select: none; /* Safari */
            -ms-user-select: none; /* IE 10+ */
            user-select: none;
            /* Pastikan tidak ada scroll bar */
            overflow: hidden;
        }
        /* Memberi efek visual saat papan ditekan */
        #board-display:active {
            transform: scale(0.98);
            filter: brightness(1.1);
            transition: transform 0.1s, filter 0.1s;
        }
        .board-display {
            display: grid;
            grid-template-columns: repeat(3, 100px);
            grid-template-rows: repeat(3, 100px);
            border: none;
            background-color: #000;
            padding: 2px;
            cursor: pointer; /* Menandakan elemen ini interaktif */
            transition: transform 0.2s, filter 0.2s;
        }
        .cell-display { width: 100px; height: 100px; display: flex; justify-content: center; align-items: center; font-size: 3.5rem; font-weight: bold; color: #E5E7EB; border-right: 4px solid #4B5563; border-bottom: 4px solid #4B5563; }
        .cell-display:nth-child(3n) { border-right: none; }
        .cell-display:nth-child(n+7) { border-bottom: none; }
        @media (max-width: 400px) {
            .board-display { grid-template-columns: repeat(3, 80px); grid-template-rows: repeat(3, 80px); }
            .cell-display { width: 80px; height: 80px; font-size: 2.5rem; }
        }
    </style>
</head>
<body class="bg-black text-gray-300 flex items-center justify-center min-h-screen">
    <!-- Judul dan tombol simpan telah dihapus dari sini -->
    <div id="board-display" class="board-display">
        <div class="cell-display" data-index="0"></div><div class="cell-display" data-index="1"></div><div class="cell-display" data-index="2"></div>
        <div class="cell-display" data-index="3"></div><div class="cell-display" data-index="4"></div><div class="cell-display" data-index="5"></div>
        <div class="cell-display" data-index="6"></div><div class="cell-display" data-index="7"></div><div class="cell-display" data-index="8"></div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.10/firebase-app.js";
        import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/9.6.10/firebase-database.js";

        const firebaseConfig = {
          apiKey: "AIzaSyBwCuf9-ASE4rAaF6KWjlwyZO9O8LMrXlc",
          authDomain: "tictactoeferdi.firebaseapp.com",
          databaseURL: "https://tictactoeferdi-default-rtdb.asia-southeast1.firebasedatabase.app",
          projectId: "tictactoeferdi",
          storageBucket: "tictactoeferdi.appspot.com",
          messagingSenderId: "868814364652",
          appId: "1:868814364652:web:1b749bad16d092b74eaac9"
        };
        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);
        const gameRef = ref(db, 'magic-game-state');

        const cells = document.querySelectorAll('.cell-display');
        const boardDisplayDiv = document.getElementById('board-display');

        function renderBoard(boardData) {
            boardData.forEach((value, index) => {
                if (cells[index]) {
                    cells[index].textContent = value || '';
                }
            });
        }
        
        onValue(gameRef, (snapshot) => {
            const finalBoard = Array(9).fill(null);
            if (snapshot.exists()) {
                const gameState = snapshot.val();
                if (gameState && gameState.board) {
                    const receivedBoardData = gameState.board;
                    for (const index in receivedBoardData) {
                        const value = receivedBoardData[index];
                        const indexNum = parseInt(index, 10);
                        if (!isNaN(indexNum) && indexNum >= 0 && indexNum < 9) {
                            finalBoard[indexNum] = value;
                        }
                    }
                }
            }
            renderBoard(finalBoard);
        });

        // --- LOGIKA BARU: TAP AND HOLD UNTUK MENYIMPAN GAMBAR ---
        
        let pressTimer = null;

        // Fungsi untuk menyimpan gambar, dipisahkan agar rapi
        function saveBoardAsPNG() {
            html2canvas(boardDisplayDiv, { backgroundColor: '#000000', useCORS: true })
                .then(canvas => {
                    const link = document.createElement('a');
                    link.download = 'papan-permainan.png';
                    link.href = canvas.toDataURL('image/png');
                    link.click();
                });
        }

        // Fungsi untuk membatalkan timer jika sentuhan dilepas terlalu cepat
        const cancelPress = () => {
            clearTimeout(pressTimer);
        };

        // Event listener untuk mouse (desktop)
        boardDisplayDiv.addEventListener('mousedown', (e) => {
            // Hanya aktif untuk klik kiri
            if (e.button !== 0) return;
            pressTimer = setTimeout(saveBoardAsPNG, 800); // Tahan selama 800ms
        });
        boardDisplayDiv.addEventListener('mouseup', cancelPress);
        boardDisplayDiv.addEventListener('mouseleave', cancelPress); // Batal jika mouse keluar dari board

        // Event listener untuk sentuhan (mobile)
        boardDisplayDiv.addEventListener('touchstart', (e) => {
            e.preventDefault(); // Mencegah menu konteks muncul di mobile
            pressTimer = setTimeout(saveBoardAsPNG, 800);
        });
        boardDisplayDiv.addEventListener('touchend', cancelPress);
        boardDisplayDiv.addEventListener('touchmove', cancelPress); // Batal jika jari bergeser

    </script>
</body>
</html>